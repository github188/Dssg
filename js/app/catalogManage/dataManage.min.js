define(["base","app/commonApp"],function(e,t){var a=null;var n={processing:true,serverSide:true,searching:false,ordering:false,lengthChange:false,pagingType:"full_numbers",ajax:{url:$.path+"/api/resCenterDataElement/findCenterDataElementPage",type:"get",contentType:"application/json",xhrFields:{withCredentials:true},data:function(e){return t.getParams(e,$("#search-form"))}},columns:[{data:"id",sWidth:"3%"},{data:"name",sWidth:"13%"},{data:"englishName",sWidth:"13%"},{data:"code",sWidth:"14%"},{data:"classifyName",sWidth:"14%"},{data:"dataType",sWidth:"11%"},{data:"dataLength",sWidth:"11%"},{data:"isDictionary",sWidth:"11%"},{data:"dictionaryName",sWidth:"10%"}],columnDefs:[{render:function(e,t,a,n){return"<input type='checkbox' name='cb' value='"+a.id+"' class='cb' cid='"+JSON.stringify(a)+"'/>"},targets:0},{render:function(e,t,a,n){return"<a href='#' cid='"+JSON.stringify(a)+"' class='data_detail'>"+a.name+"</a>"},targets:1},{render:function(e,t,a,n){var i=a.dataType;if(i==3){return"数字"}else if(i==4){return"整型"}else if(i==12){return"文本"}else if(i==91){return"日期"}else if(i==93){return"时间"}},targets:5},{render:function(e,t,a,n){var i=a.dataLength;if(i==null||i==""){return"--"}else{return i}},targets:6},{render:function(e,t,a,n){var i=a.isDictionary;if(i=="0"){return"是"}else{return"否"}},targets:7},{render:function(e,t,a,n){var i=a.dictionaryName;if(i==null||i==""){return"--"}else{return i}},targets:8}],drawCallback:function(a){e.selectAll($("#cball"),$(".cb"),function(){t.checkByGridButton($(".cb"))});$(".data_detail").on("click",function(){f(this)});t.selectedTr($("#example"))}};var i=function(){a=e.datatables({container:$("#example"),option:n,filter:t.gridFilter})};var r=function(){$("#search").on("click",function(){t.search(a)})};var c=function(){$("#reset").on("click",function(){t.reset($("#search-form"),a)})};var s=function(){$(".ui-grid-buttonbar .add").on("click",function(){d()});$(".ui-grid-buttonbar .delete").on("click",function(){if($(this).hasClass("disabled")){return}else{o()}});$(".ui-grid-buttonbar .modify").on("click",function(){if($(this).hasClass("disabled")){return}else{l()}});$(".import").click(function(){$("#file").replaceWith('<input type="file" name="file" id="file" style="display: none;"/>');$("#file").trigger("click")});$(".export").click(function(){var t=e.getChecks("cb");window.location.href=$.path+"/api/resCenterDataElement/downloadDataElement?ids="+t})};var l=function(){var n={cid:$(".ui-grid .cb:checked").attr("cid")};var i=e.modal({width:800,height:400,label:"修改",url:"../html/catalogManage/dataManage_add.html",buttons:[{label:"保存",cls:"btn btn-info",clickEvent:function(){e.form.validate({form:$("#form"),checkAll:true,passCallback:function(){var n=e.form.getParams($("#form"));if(n){t.submit({url:$.path+"/api/resCenterDataElement/updateCenterDataElement",params:n,type:"post"});i.hide();t.search(a);t.initButtonbar($(".ui-grid-buttonbar"))}}})}},{label:"重置",cls:"btn btn-warning",clickEvent:function(){t.reset($("#form"))}}],callback:function(){var t=JSON.parse($(".ui-grid .cb:checked").attr("cid"));e.form.init(t,$("#form"));$("#form select[name='classify']").attr("disabled","disabled");$("#form select[name='isDictionary']").attr("disabled","disabled");$("#form select[name='dictionaryId']").attr("disabled","disabled")}})};var o=function(){var n=e.getChecks("cb");e.confirm({confirmCallback:function(){t.submit({url:$.path+"/api/resCenterDataElement/deleteCenterDataElement",params:n,type:"post",callback:function(){t.search(a)}})}})};var d=function(){$("#button_type").val();var n=e.modal({width:800,height:400,label:"新建",url:"../html/catalogManage/dataManage_add.html",buttons:[{label:"保存",cls:"btn btn-info",clickEvent:function(){e.form.validate({form:$("#form"),checkAll:true,passCallback:function(){var i=e.form.getParams($("#form"));if(i){t.submit({url:$.path+"/api/resCenterDataElement/saveCenterDataElement",params:i,type:"post",callback:function(){t.search(a);n.hide()}})}}})}},{label:"重置",cls:"btn btn-warning",clickEvent:function(){t.reset($("#form"))}}]})};var f=function(t){var a=e.modal({width:800,height:400,label:"详情",url:"../html/catalogManage/dataManage_detail.html",buttons:[{label:"关闭",cls:"btn btn-info",clickEvent:function(){a.hide()}}],callback:function(){var e=JSON.parse($(t).attr("cid"));switch(e.isDictionary){case"1":$("#form .dictionaryName").hide();$("#isDictionary1").text("否");break;case"0":$("#form .dictionaryName").show();$("#isDictionary1").text("是");break}switch(e.dataType){case"3":$("#dataType").text("数字");$("#form .dataLength").show();break;case"4":$("#dataType").text("整型");$("#form .dataLength").hide();break;case"12":$("#dataType").text("文本");$("#form .dataLength").show();break;case"91":$("#dataType").text("日期");$("#form .dataLength").hide();break;case"93":$("#dataType").text("时间");$("#form .dataLength").hide();break}$("#form .versionNumber").text(e.versionNumber);$("#form #data_name").text(e.name);$("#form #englishName").text(e.englishName);$("#form #data_code").text(e.code);$("#form #classifyName").text(e.classifyName);$("#form #updateDate").text(e.updateDate);$("#form #valueScope").text(e.valueScope?e.valueScope:"");$("#form #submitCompany").text(e.submitCompany);$("#form #submitUser").text(e.submitUser);$("#form #versionDate").text(e.versionDate?e.versionDate:"");$("#form #dataLength").text(e.dataLength)}})};var u=function(){e.scroll({container:$(".ui-gridbar")});$.ajax({url:$.path+"/api/sysBussinessDictionary/findDictionaryByType",data:JSON.stringify({type:3,name:"classify"}),type:"post",contentType:"application/json",xhrFields:{withCredentials:true},success:function(e){$(e.data.classify).each(function(e,t){$("select[name='classify']").append("<option value='"+t.key+"'>"+t.label+"</option>")})}});$(".dataManageFile").on("change","#file",function(){var t=e.getChecks("cb");e.form.fileUpload({url:$.path+"/api/resCenterDataElement/uploadDataElement",id:"file",params:{ids:t},success:function(t){switch(t.status){case"1":e.requestTip({position:"center"}).success("附件上传成功！");break;default:e.requestTip({position:"center"}).error("附件上传失败！");break}},error:function(){}})})};return{main:function(){i();s();r();c();u()}}});