define(["base","app/commonApp"],function(e,t){var a=null;var r={processing:true,serverSide:true,searching:false,ordering:false,lengthChange:false,pagingType:"full_numbers",ajax:{url:$.path+"/api/sysroles/findSysRolesByPage",type:"get",xhrFields:{withCredentials:true},data:function(e){t.gridPageFliter(e);return{page:e.page,size:e.size}}},columns:[{data:"id",sWidth:"10%"},{data:"roleName",sWidth:"15%"},{data:"des",sWidth:"25%"},{data:"menu",sWidth:"50%"}],columnDefs:[{render:function(e,t,a,r){return"<div class='checkboxWrapper'><input type='checkbox' name='cb' value='"+a.roleId+"' class='cb' ccode = '' cid='"+a.roleId+"'/></div>"},targets:0},{render:function(e,t,a,r){var i=a.name;if(i){return"<div title='"+i+"'>"+i+"</div>"}else{return""}},targets:1},{render:function(e,t,a,r){var i=a.description;if(i){if(i.length>20){return"<div title='"+i+"'>"+i.substr(0,20)+"...</div>"}else{return"<div title='"+i+"'>"+i+"</div>"}}else{return"--"}},targets:2},{render:function(e,t,a,r){var i=a.menus;if(i){if(i.length>50){return"<div title='"+i+"'>"+i.substr(0,40)+"...</div>"}else{return"<div title='"+i+"'>"+i+"</div>"}}else{return"--"}},targets:3}],drawCallback:function(a){e.selectAll($("#cball"),$(".cb"),function(){t.checkByGridButton($(".cb"))});t.selectedTr($("#role"))}};var i=function(){a=e.datatables({container:$("#role"),option:r,filter:t.gridFilter})};var n=function(){$(".ui-grid-buttonbar .add").on("click",function(){if(!$(this).hasClass("disabled")){s()}});$(".ui-grid-buttonbar .delete").on("click",function(){if(!$(this).hasClass("disabled")){c()}});$(".ui-grid-buttonbar .modify").on("click",function(){if(!$(this).hasClass("disabled")){if($(this).hasClass("setting")){o()}else{l()}}})};var s=function(){var r=e.modal({label:"新建",width:700,height:270,url:"../html/systemManage/roleOperation/create.html",drag:true,buttons:[{label:"保存",cls:"btn btn-info",clickEvent:function(){e.form.validate({form:$("#form"),checkAll:true,passCallback:function(){var i=e.form.getParams($("#form"));if(i){t.submit({url:$.path+"/api/sysroles/saveSysRoles",params:i,type:"post",callback:function(e){if(e.code==0){e.message="保存成功"}else{e.message="保存失败"}t.search(a)}});r.hide()}}})}},{label:"重置",cls:"btn btn-warning",clickEvent:function(){t.reset($("#form"))}}]})};var l=function(){var r={id:$(".ui-grid .cb:checked").attr("cid")};var i=e.modal({label:"修改",width:700,height:270,url:"../html/systemManage/roleOperation/modify.html",drag:true,callback:function(){e.ajax({url:$.path+"/api/sysroles/findSysRolesByIdInfo?id="+$(".ui-grid .cb:checked").attr("cid"),type:"get",success:function(t){if(t.code=="0"){var a=t.data;e.form.init(a,$("#form"));$("#form").find("input[name='code']").attr("disabled",true)}},error:function(e){}})},buttons:[{label:"保存",cls:"btn btn-info",clickEvent:function(){e.form.validate({form:$("#form"),checkAll:true,passCallback:function(){var n=e.form.getParams($("#form"));if(n){var s=$.extend(r,n);t.submit({url:$.path+"/api/sysroles/updateSysRoles",params:s,type:"post",callback:function(e){if(e.code==0){e.message="保存成功"}else{e.message="保存失败"}t.search(a)}});i.hide()}}})}},{label:"重置",cls:"btn btn-warning",clickEvent:function(){t.reset($("#form"))}}]})};var c=function(){var r=e.getChecks("cb");e.confirm({confirmCallback:function(){t.submit({url:$.path+"/api/sysroles/deleteSysRoles",params:r,type:"post",callback:function(e){if(e.code==0){e.message="删除成功"}else{e.message="删除失败"}t.search(a)}})}})};var o=function(){var r={roleid:$(".ui-grid .cb:checked").attr("cid")};var i=e.modal({label:"配置菜单",width:900,height:450,url:"../html/systemManage/roleOperation/setting.html",drag:true,callback:function(){e.ajax({url:$.path+"/api/sysmenus/findSysMenusAllList?roleId="+$(".ui-grid .cb:checked").attr("cid"),type:"get",success:function(t){if(t.code=="0"){if(t.data.roleName){$("#form").find("input[name='roleName']").val(t.data.roleName).attr("disabled",true)}var a=t.data.allMenu;var r=t.data.myMenu;tree=e.tree({container:$("#set-setting"),setting:{check:{enable:true,chkStyle:"checkbox",chkboxType:{Y:"ps",N:"ps"}},view:{selectedMulti:false,showIcon:false,showLine:false},callback:{},data:{simpleData:{enable:false,idKey:"key",pIdKey:""},key:{children:"children",name:"label",title:"key"}}},data:a});var i=$.fn.zTree.getZTreeObj("set-setting");i.expandAll(true);var n=setTimeout(function(){for(var e=0;e<r.length;e++){code=i.getNodesByParamFuzzy("key",r[e],null)[0];if(code){i.checkNode(code,true)}}},100)}}})},buttons:[{label:"保存",cls:"btn btn-info",clickEvent:function(){e.form.validate({form:$("#form"),checkAll:true,passCallback:function(){var e=$.fn.zTree.getZTreeObj("set-setting");var n=e.getCheckedNodes(true);var s=[];n.forEach(function(e){s.push(e.key)});var l=$.extend(r,{menuids:s});t.submit({url:$.path+"/api/sysroles/assignMenus",params:l,type:"post",callback:function(e){if(e.code==0){e.message="保存成功"}else{e.message="保存失败"}t.search(a)}});i.hide()}})}}]})};var d=function(){e.scroll({container:$(".ui-gridbar")})};return{main:function(){i();n();d()}}});