define(["base","app/commonApp","app/mainApp"],function(e,t,n){var s=null;var a={processing:true,serverSide:true,searching:false,ordering:false,lengthChange:false,pagingType:"full_numbers",ajax:{url:$.path+"/api/sysmessage/findSysMessage",type:"get",xhrFields:{withCredentials:true},data:function(n){t.gridPageFliter(n);var s=e.form.getParams($("#search-form"));var a;if(s){a=$.extend({page:n.page,size:n.size},s)}return a}},columns:[{data:"id",sWidth:"10%"},{data:"content",sWidth:"50%"},{data:"createTime",sWidth:"40%"}],columnDefs:[{render:function(e,t,n,s){return"<div class='checkboxWrapper'><input type='checkbox' name='cb' value='"+n.id+"' class='cb' cid='"+n.id+"'/></div>"},targets:0},{render:function(e,t,n,s){var a=n.type;if(n.state=="1"){if(a=="4"){return"<div title='"+n.content+"' class='notread notdo' csrc='"+n.menuClassification+"'><b>【待办事项】&nbsp;"+n.content+"</b></div>"}else if(a=="2"){return"<div title='"+n.content+"' class='notread'><b>【系统消息】&nbsp;"+n.content+"</b></div>"}else{return"<div title='"+n.content+"' class='notread'><b>【告警消息】&nbsp;"+n.content+"</b></div>"}}else{if(a=="4"){return"<div title='"+n.content+"'>【待办事项】&nbsp;"+n.content+"</div>"}else if(a=="2"){return"<div title='"+n.content+"'>【系统消息】&nbsp;"+n.content+"</div>"}else{return"<div title='"+n.content+"'>【告警消息】&nbsp;"+n.content+"</div>"}}},targets:1}],drawCallback:function(n){e.selectAll($("#cball"),$(".cb"),function(){t.checkByGridButton($(".cb"))});t.selectedTr($("#msg"))}};var i=function(){s=e.datatables({container:$("#msg"),option:a,filter:t.gridFilter})};var r=function(){$(".ui-grid-buttonbar button").on("click",function(){if(!$(this).hasClass("disabled")){if($(this).hasClass("read")){l()}else{d()}}})};var c=function(){$("#search").on("click",function(){t.search(s)})};var o=function(){$("#reset").off().on("click",function(){t.reset($(this).parents(".ui-searchbar").find("form"),s)})};var d=function(){var n=e.getChecks("cb");e.confirm({label:"删除",text:"<div style='text-align:center;font-size:13px;'>确定删除?</div>",confirmCallback:function(){t.submit({url:$.path+"/api/sysmessage/deleteSysMessage",params:n,type:"post",callback:function(e){if(e.code==0){e.message="删除成功"}else{e.message="删除失败"}t.search(s)}})}})};var l=function(){var n=e.getChecks("cb");t.submit({url:$.path+"/api/sysmessage/updateSysMessageIsRead",params:n,type:"post",callback:function(e){if(e.code==0){e.message="标记未读为已读成功"}else{e.message="标记未读为已读失败"}t.search(s)}})};var f=function(){$("#msg").find("tbody").on("click","td",function(){var a=[];var i=$(this);if(i.find(".notread").length>0){var r=i.parents("tr").find("td:first .cb").attr("cid");a.push(r)}if(a.length>0){e.ajax({url:$.path+"/api/sysmessage/updateSysMessageIsRead",params:a,type:"post",success:function(e){if(e.code==0){e.message="标记已读成功"}else{e.message="标记已读失败"}if(i.find(".notdo").length<1){t.search(s)}}})}if(i.find(".notdo").length>0){var c=i.find(".notdo").attr("csrc");n.loadPage(c)}})};var u=function(){e.scroll({container:$(".ui-gridbar")})};return{main:function(){i();r();c();o();u();f()}}});