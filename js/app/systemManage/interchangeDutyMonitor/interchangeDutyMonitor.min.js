define(["base","app/commonApp"],function(e,t){var a=null,i=null,s=null;var r={processing:true,serverSide:true,searching:false,ordering:false,lengthChange:false,pagingType:"full_numbers",ajax:{url:$.path+"/api/resourcemonitor/findPublishResourceByPage",type:"get",contentType:"application/json",xhrFields:{withCredentials:true},data:function(a){t.gridPageFliter(a);var i=e.form.getParams($("#publishRes-form"));var s;if(JSON.stringify(i)!="{}"){s=$.extend({page:a.page,size:a.size},i)}else{s={page:a.page,size:a.size}}return s}},columns:[{data:"id",sWidth:"5%"},{data:"taskName",sWidth:"25%"},{data:"resTypeName",sWidth:"20%"},{data:"stateName",sWidth:"25%"},{data:"nextTime",sWidth:"25%"}],columnDefs:[{render:function(e,t,a,i){return"<div class='checkboxWrapper'><input type='checkbox' name='pcb' class='cb1' value='"+a.id+"' cAll = '"+JSON.stringify(a)+"'/></div>"},targets:0},{render:function(e,t,a,i){if(a.taskName){return a.taskName}else{return"--"}},targets:1},{render:function(e,t,a,i){if(a.resTypeName){return a.resTypeName}else{return"--"}},targets:2},{render:function(e,t,a,i){if(a.stateName){return"<div class='state' title='"+a.state+"'>"+a.stateName;+"</div>"}else{return"--"}},targets:3},{render:function(e,t,a,i){if(a.nextTime){return a.nextTime}else{return"--"}},targets:4}],drawCallback:function(a){e.selectAll($("#cball1"),$(".cb1"),function(){t.checkByGridButton($(".cb1"))});t.selectedTr($("#publishRes"))}};var n={processing:true,serverSide:true,searching:false,ordering:false,lengthChange:false,ajax:{url:$.path+"/api/resourcemonitor/findSubscribeResourceByPage",type:"get",contentType:"application/json",xhrFields:{withCredentials:true},data:function(a){t.gridPageFliter(a);var i=e.form.getParams($("#subscibeRes-form"));var s;if(i){s=$.extend({page:a.page,size:a.size},i)}return s}},columns:[{data:"id",sWidth:"5%"},{data:"taskName",sWidth:"20%"},{data:"resTypeName",sWidth:"15%"},{data:"pubEquipmentName",sWidth:"20%"},{data:"stateName",sWidth:"20%"},{data:"nextTime",sWidth:"20%"}],columnDefs:[{render:function(e,t,a,i){return"<div class='checkboxWrapper'><input type='checkbox' name='scb' value='"+a.id+"' class='cb2' cAll = '"+JSON.stringify(a)+"'/></div>"},targets:0},{render:function(e,t,a,i){if(a.taskName){return a.taskName}else{return"--"}},targets:1},{render:function(e,t,a,i){if(a.resTypeName){return a.resTypeName}else{return"--"}},targets:2},{render:function(e,t,a,i){if(a.pubEquipmentName){return a.pubEquipmentName}else{return"--"}},targets:3},{render:function(e,t,a,i){if(a.stateName){return"<div class='state' title='"+a.state+"'>"+a.stateName;+"</div>"}else{return"--"}},targets:4},{render:function(e,t,a,i){if(a.nextTime){return a.nextTime}else{return"--"}},targets:5}],drawCallback:function(a){e.selectAll($("#cball2"),$(".cb2"),function(){t.checkByGridButton($(".cb2"))});t.selectedTr($("#subscibeRes"))}};var c=function(c){switch(c){case"0":a=e.datatables({container:$("#publishRes"),option:r,filter:t.gridFilter});i=a;break;case"1":a=e.datatables({container:$("#subscibeRes"),option:n,filter:t.gridFilter});s=a;break}};var d=function(){$(".search").on("click",function(){var e=$(".ui-grid-linkGroup").find("li.active").attr("key");if(e=="0"){i.reload()}else{s.reload()}})};var l=function(){$(".reset").on("click",function(){var e=$(".ui-grid-linkGroup").find("li.active").attr("key");if(e=="0"){$("form input").val("");i.reload()}else{$("form input").val("");s.reload()}})};var u=function(){e.confirm({label:"启用",text:"<div style='text-align:center;font-size:13px;'>确定启用?</div>",confirmCallback:function(){var e=$(".ui-grid-linkGroup").find("li.active").attr("key");var a=[];var r=e=="0"?$("#publishRes .cb1:checked"):$("#subscibeRes .cb2:checked");r.map(function(t,i){var s=$(i).attr("cAll");s=JSON.parse(s);var r={id:s.id,pubEquipmentId:s.pubEquipmentId,actionType:e=="0"?1:2,subEquipmentId:s.subEquipmentId,type:0};a.push(r)});t.submit({url:$.path+"/api/resourcemonitor/startStopTaskBatch",params:a,type:"post",callback:function(a){if(a.code=="0"&&a.data){a.message="启用成功"}else{a.message="启用失败"}if(e=="0"){t.search(i)}else{t.search(s)}}})}})};var o=function(){var a=$(".ui-grid-linkGroup").find("li.active").attr("key");var r=a=="0"?$("#publishRes .cb1:checked"):$("#subscibeRes .cb2:checked");e.confirm({label:"停用",text:"<div style='text-align:center;font-size:13px;'>确定停用?</div>",confirmCallback:function(){var e=[];r.map(function(t,i){var s=$(i).attr("cAll");s=JSON.parse(s);var r={id:s.id,pubEquipmentId:s.pubEquipmentId,actionType:a=="0"?1:2,subEquipmentId:s.subEquipmentId,type:-1};e.push(r)});t.submit({url:$.path+"/api/resourcemonitor/startStopTaskBatch",params:e,type:"post",callback:function(e){if(e.code==0&&e.data){e.message="停用成功"}else{e.message="停用失败"}if(a=="0"){t.search(i)}else{t.search(s)}}})}})};var p=function(){e.confirm({label:"调度",text:"<div style='text-align:center;font-size:13px;'>确定调度?</div>",confirmCallback:function(){var e=$(".ui-grid .cb2:checked").attr("cAll");var a=JSON.parse(e);var i=$(".ui-grid .cb2:checked").parents("tr").find("td:nth-child(3)").html();var r=i=="数据库"?1:2;var n={id:a.id,pubEquipmentId:a.pubEquipmentId,resourceType:r,subEquipmentId:a.subEquipmentId};t.submit({url:$.path+"/api/resourcemonitor/dispatchTask",params:n,type:"post",callback:function(e){if(e.code=="0"){e.message="调度成功"}t.search(s)}})}})};var f=function(){$(".ui-grid-linkGroup li").on("click",function(){$(".ui-grid-linkGroup .active").removeClass("active");$(this).addClass("active");var e=$(this).attr("key");switch(e){case"0":$("#subscibeRes").find("input").attr("checked",false);$(".modify").addClass("disabled");$("#publishRes-form").show();$("#subscibeRes-form").hide();$(".dispatch").parent().hide();$(".publishRes").show();$(".subscibeResWrapper").hide();i.grid.ajax.reload();break;case"1":$("#publishRes").find("input").attr("checked",false);$(".modify").addClass("disabled");$("#publishRes-form").hide();$("#subscibeRes-form").show();$(".dispatch").parent().show();$(".publishRes").hide();$(".subscibeResWrapper").show();s.grid.ajax.reload();break}})};var b=function(){$(".ui-grid-buttonbar .modify").on("click",function(){if(!$(this).hasClass("disabled")){var e=$(this).attr("keyAtrr");switch(e){case"2":p();break}}});$(".ui-grid-buttonbar .delete").on("click",function(){if(!$(this).hasClass("disabled")){var e=$(this).attr("keyAtrr");switch(e){case"0":u();break;case"1":o();break}}});$("table").on("change","input",function(){var t=[],a="",i=$(".ui-grid-linkGroup li.active").attr("key");if(i=="0"){a="publishRes"}else{a="subscibeRes"}if($("#"+a+" tbody input:checked").length>0){$("#"+a+" tbody input:checked").map(function(e,a){var i=$(this).parents("tr").find(".state").attr("title");if(e=="0"){t.push(i)}else{if(t.indexOf(i)<0){t.push(i)}}});if(t.length>1){$(".start").addClass("disabled");$(".stop").addClass("disabled");return e.requestTip().error("不同的状态不能同时勾选")}if(t[0]=="2"){$(".start").addClass("disabled")}else if(t[0]=="4"&&i=="1"){$(".stop").addClass("disabled");$(".start").addClass("disabled");$(".dispatch").addClass("disabled")}else if(t[0]=="5"&&i=="0"){}else{$(".stop").addClass("disabled")}}})};var h=function(){e.scroll({container:$(".ui-gridbar")})};return{main:function(){c("0");c("1");f();d();l();b();h()}}});