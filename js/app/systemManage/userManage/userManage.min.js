define(["base","app/commonApp"],function(e,t){var a=null;var r={processing:true,serverSide:true,searching:false,ordering:false,lengthChange:false,pagingType:"full_numbers",ajax:{url:$.path+"/api/sysuser/findSysUser",type:"get",xhrFields:{withCredentials:true},data:function(a){t.gridPageFliter(a);var r=e.form.getParams($("#search-form"));var i;if(r){return i=$.extend(r,{page:a.page,size:a.size})}}},columns:[{data:"id",sWidth:"5%"},{data:"loginName",sWidth:"15%"},{data:"userName",sWidth:"15%"},{data:"roleName",sWidth:"12%"},{data:"telphone",sWidth:"11%"},{data:"cellPhoneNumber",sWidth:"11%"},{data:"email",sWidth:"11%"},{data:"state",sWidth:"10%"}],columnDefs:[{render:function(e,t,a,r){return"<div class='checkboxWrapper'><input type='checkbox' name='cb' value='"+a.id+"' class='cb' cid='"+a.id+"'/></div>"},targets:0},{render:function(e,t,a,r){return"<div cid='"+a.id+"' class='loginName' style='cursor:pointer'>"+a.loginName+"</div>"},targets:1},{render:function(e,t,a,r){if(a.telphone){return"<div>"+a.telphone+"</div>"}else{return"--"}},targets:4},{render:function(e,t,a,r){if(a.cellPhoneNumber){return"<div>"+a.cellPhoneNumber+"</div>"}else{return"--"}},targets:5},{render:function(e,t,a,r){if(a.email){return"<div>"+a.email+"</div>"}else{return"--"}},targets:6},{render:function(e,t,a,r){switch(a.state){case"0":return"正常";break;case"-1":return"停用";break;default:return"停用";break}},targets:7}],drawCallback:function(a){e.selectAll($("#cball"),$(".cb"),function(){t.checkByGridButton($(".cb"))});i();t.selectedTr($("#user"))}};function i(){$(".loginName").off().on("click",function(){m($(this).attr("cid"))})}var n=function(){a=e.datatables({container:$("#user"),option:r,filter:t.gridFilter})};var s=function(t){e.ajax({type:"get",url:$.path+"/api/sysroles/findRoleList",success:function(a){e.template({container:t,templateId:"userRole-tpl",data:a.data})}})};var c=function(){$(".ui-grid-buttonbar .add").on("click",function(){debugger;if(!$(this).hasClass("disabled")){l()}});$(".ui-grid-buttonbar .delete").on("click",function(){if(!$(this).hasClass("disabled")){o()}});$(".ui-grid-buttonbar .modify").on("click",function(){if(!$(this).hasClass("disabled")){var e=$(this).attr("keyAtrr");switch(e){case"0":d();break;case"2":h();break;case"3":b();break;case"4":p();break}}})};var l=function(){var r=e.modal({label:"新建",width:700,height:270,url:"../html/systemManage/userOperation/create.html",drag:true,callback:function(){s($(".userRole"))},buttons:[{label:"保存",cls:"btn btn-info",clickEvent:function(){e.form.validate({form:$("#form"),checkAll:true,passCallback:function(){if($(".checkName").attr("cstate")=="true"){var i=e.form.getParams($("#form"));if(i)if(i){t.submit({url:$.path+"/api/sysuser/saveSysUser",params:i,type:"post",callback:function(e){if(e.code==0){e.message="保存成功"}else{e.message="保存失败"}t.search(a)}});r.hide()}}else if($()){e.requestTip({position:"center"}).error("用户名重复")}}})}},{label:"重置",cls:"btn btn-warning",clickEvent:function(){t.reset($("#form"))}}]})};var o=function(){var r=e.getChecks("cb"),i=false,n=$("#user").find(".loginName").length;for(var s=0;s<n;s++){var c=$("#user").find(".loginName:nth-child("+(s+1)+")");$("#user .loginName").map(function(e,t){if($(this).html()=="admin"){if(r.indexOf($(this).attr("cid"))>-1){i=true}}})}if(i){return e.requestTip().error("超级管理员不允许删除")}e.confirm({confirmCallback:function(){t.submit({url:$.path+"/api/sysuser/deleteSysUser",params:r,type:"post",callback:function(e){if(e.code==0){e.message="删除成功"}else{e.message="删除失败"}t.search(a)}})}})};var u=function(){$("#search").on("click",function(){t.search(a)})};var f=function(){$("#reset").on("click",function(){t.reset($("#search-form"),a)})};var d=function(){var r={roleid:$(".ui-grid .cb:checked").attr("cid")};var i=e.modal({label:"修改",width:700,height:270,url:"../html/systemManage/userOperation/modify.html",drag:true,callback:function(){e.ajax({url:$.path+"/api/sysuser/findSysUserById?id="+$(".ui-grid .cb:checked").attr("cid"),type:"get",success:function(t){if(t.code=="0"){var a=t.data;e.form.init(a,$("#form"));$("#form").find("input[name='loginName']").attr("disabled",true);$("#form").find("input[name='userName']").attr("disabled",true);$("#form").find("select[name='roleId']").append("<option value='"+a.roleId+"'>"+a.roleName+"</option>").attr("disabled",true)}},error:function(e){}})},buttons:[{label:"保存",cls:"btn btn-info",clickEvent:function(){if($(".checkName").attr("cstate")){e.form.validate({form:$("#form"),checkAll:true,passCallback:function(){var r=e.form.getParams($("#form"));if(r){t.submit({url:$.path+"/api/sysuser/updateSysUser",type:"post",params:r,callback:function(){t.search(a)}});i.hide()}}})}else{e.requestTip().error("用户名重复，需重新填写")}}},{label:"重置",cls:"btn btn-warning",clickEvent:function(){t.reset($("#form"))}}]})};var m=function(t){var a=e.modal({label:"查看",width:700,height:270,url:"../html/systemManage/userOperation/view.html",drag:true,callback:function(){e.ajax({url:$.path+"/api/sysuser/findSysUserById?id="+t,type:"get",success:function(e){if(e.code=="0"){var t=e.data;$.each(t,function(e,t){if(e=="state"){if(t=="0"){$("#form .state").html("正常")}else if(t=="-1"){$("#form .state").html("停用")}else{$("#form .state").html("停用")}}else{if(t){$("#form").find("."+e).html(t)}else{$("#form").find("."+e).html("--")}}})}},error:function(e){}})},buttons:[{label:"取消",cls:"btn btn-info",clickEvent:function(){a.hide()}}]})};var h=function(){e.confirm({label:"停用",text:"<div style='text-align:center;font-size:13px;'>确定停用?</div>",confirmCallback:function(){t.submit({url:$.path+"/api/sysuser/startOrStopSysUser?id="+$(".ui-grid .cb:checked").attr("cid")+"&state=-1",type:"get",callback:function(){t.search(a)}})}})};var b=function(){e.confirm({label:"启用",text:"<div style='text-align:center;font-size:13px;'>确定启用?</div>",confirmCallback:function(){t.submit({url:$.path+"/api/sysuser/startOrStopSysUser?id="+$(".ui-grid .cb:checked").attr("cid")+"&state=0",type:"get",callback:function(){t.search(a)}})}})};var p=function(){var r={id:e.getCR("cb",true)};e.confirm({label:"告警信息",text:"<div style='text-align:center;font-size:13px;'>确定重置密码?</div>",confirmCallback:function(){t.submit({url:$.path+"/api/sysuser/resetUserPassword",type:"get",params:r,callback:function(){t.search(a)}})}})};var g=function(){e.scroll({container:$(".ui-gridbar")})};return{main:function(){n();c();s($(".resTypeName"));u();f();g()}}});