define(["base","app/commonApp"],function(e,t){var i=null,r=null,a=null;var s={processing:true,serverSide:true,searching:false,ordering:false,lengthChange:false,pagingType:"full_numbers",ajax:{url:$.path+"/api/apiResourceMonitor/myPublishResourceByPage",type:"get",xhrFields:{withCredentials:true},contentType:"application/json",data:function(i){t.gridPageFliter(i);var r=e.form.getParams("#publishRes-form");var a;if(r){a=$.extend({page:i.page,size:i.size},r)}return a}},columns:[{data:"id",sWidth:"2%"},{data:"taskName",sWidth:"18%"},{data:"appName",sWidth:"14%"},{data:"apiSource",sWidth:"8%"},{data:"state",sWidth:"10%"},{data:"requestTime",sWidth:"14%"},{data:"requestNumber",sWidth:"17%"},{data:"currentNumber",sWidth:"17%"}],columnDefs:[{render:function(e,t,i,r){return"<div class='checkboxWrapper'><input type='checkbox' name='pcb' value='"+i.id+"' class='cb1' cAll = '"+JSON.stringify(i)+"'/></div>"},targets:0},{render:function(e,t,i,r){var a=i.appName;if(a){return a}else{return"--"}},targets:2},{render:function(e,t,i,r){var a=i.apiSource;if(a){if(a=="local"){return"<div title='"+a+"'>本地</div>"}else{return"<div title='"+a+"'>第三方</div>"}}else{return"--"}},targets:3},{render:function(e,t,i,r){var a=i.state;if(a){if(a=="0"&&i.stateSubs=="0"){return"<div class='state' title='"+a+"'>启用</div>"}else if(a=="-1"&&i.stateSubs=="0"){return"<div class='state' title='"+a+"'>发布方暂停</div>"}else if(a=="-1"&&i.stateSubs=="-1"){return"<div class='state' title='"+a+"'>发布方暂停</div>"}else if(a=="0"&&i.stateSubs=="-1"){return"<div class='state' title='"+a+"'>订阅方暂停</div>"}}else{return""}},targets:4},{render:function(e,t,i,r){if(i.requestTime){return"<div>"+i.requestTime+"</div>"}else{return"--"}},targets:5},{render:function(e,t,i,r){if(i.requestNumber){return"<div>"+i.requestNumber+"</div>"}else{return"--"}},targets:6},{render:function(e,t,i,r){if(i.currentNumber){return"<div>"+i.currentNumber+"</div>"}else{return"0"}},targets:7}],drawCallback:function(i){e.selectAll($("#cball1"),$(".cb1"),function(){t.checkByGridButton($(".cb1"))});t.selectedTr($("#publishRes"))}};var n={processing:true,serverSide:true,searching:false,ordering:false,lengthChange:false,ajax:{url:$.path+"/api/apiResourceMonitor/mySubscribeResourceByPage",type:"get",contentType:"application/json",xhrFields:{withCredentials:true},data:function(i){t.gridPageFliter(i);var r=e.form.getParams($("#subscibeRes-form"));var a;if(r){a=$.extend({page:i.page,size:i.size},r)}return a}},columns:[{data:"id",sWidth:"2%"},{data:"taskName",sWidth:"16%"},{data:"AppName",sWidth:"12%"},{data:"apiSource",sWidth:"8%"},{data:"pubEquipmentName",sWidth:"10%"},{data:"state",sWidth:"9%"},{data:"requestTime",sWidth:"15%"},{data:"requestNumber",sWidth:"14%"},{data:"currentNumber",sWidth:"14%"}],columnDefs:[{render:function(e,t,i,r){return"<div class='checkboxWrapper'><input type='checkbox' name='cb' value='"+i.id+"' class='cb2' cAll = '"+JSON.stringify(i)+"'/></div>"},targets:0},{render:function(e,t,i,r){var a=i.appName;if(a){return a}else{return"--"}},targets:2},{render:function(e,t,i,r){var a=i.apiSource;if(a){if(a=="local"){return"<div title='"+a+"'>本地</div>"}else{return"<div title='"+a+"'>第三方</div>"}}else{return""}},targets:3},{render:function(e,t,i,r){var a=i.stateSubs;if(a){if(a=="0"&&i.state=="0"){return"<div class='state' title='"+a+"'>启用</div>"}else if(i.state=="-1"&&a=="-1"){return"<div class='state' title='"+a+"'>发布方暂停</div>"}else if(a=="-1"){return"<div class='state' title='"+a+"'>订阅方暂停</div>"}else if(i.state=="-1"&&a=="0"){return"<div class='state' title='"+a+"'>发布方暂停</div>"}}else{return"--"}},targets:5},{render:function(e,t,i,r){if(i.requestTime){return"<div>"+i.requestTime+"</div>"}else{return"--"}},targets:6},{render:function(e,t,i,r){if(i.requestNumber){return"<div>"+i.requestNumber+"</div>"}else{return"--"}},targets:7},{render:function(e,t,i,r){if(i.currentNumber){return"<div>"+i.currentNumber+"</div>"}else{return"0"}},targets:8}],drawCallback:function(i){e.selectAll($("#cball2"),$(".cb2"),function(){t.checkByGridButton($(".cb2"))});t.selectedTr($("#subscibeRes"))}};var u=function(u){switch(u){case"1":i=e.datatables({container:$("#publishRes"),option:s,filter:t.gridFilter});r=i;break;case"2":i=e.datatables({container:$("#subscibeRes"),option:n,filter:t.gridFilter});a=i;break}};var l=function(){$(".search").on("click",function(){var e=$(".ui-grid-linkGroup").find("li.active").attr("key");if(e=="0"){r.reload()}else{a.reload()}})};var c=function(){$(".reset").off().on("click",function(){var e=$(".ui-grid-linkGroup").find("li.active").attr("key");if(e=="0"){$("form input").val("");r.reload()}else{$("form input").val("");a.reload()}})};var d=function(){e.confirm({label:"启用",text:"<div style='text-align:center;font-size:13px;'>确定启用?</div>",confirmCallback:function(){var e=$(".ui-grid-linkGroup").find("li.active").attr("key");var i=[];var s=e=="0"?$("#publishRes .cb1:checked"):$("#subscibeRes .cb2:checked");s.map(function(t,r){var a=$(r).attr("cAll");a=JSON.parse(a);var s={id:a.id,actionType:e=="0"?1:2};if(e=="0"){s.state=0}else{s.stateSubs=0}i.push(s)});t.submit({url:$.path+"/api/apiResourceMonitor/startStopService",params:i,type:"post",callback:function(i){if(i.code==0){i.message="启用成功"}else{i.message="启用失败"}if(e=="0"){t.search(r)}else{t.search(a)}}})}})};var o=function(){e.confirm({label:"暂停",text:"<div style='text-align:center;font-size:13px;'>确定暂停?</div>",confirmCallback:function(){var e=$(".ui-grid-linkGroup").find("li.active").attr("key");var i=[];var s=e=="0"?$("#publishRes .cb1:checked"):$("#subscibeRes .cb2:checked");s.map(function(t,r){var a=$(r).attr("cAll");a=JSON.parse(a);var s={id:a.id,actionType:e=="0"?1:2};if(e=="0"){s.state=-1}else{s.stateSubs=-1}i.push(s)});t.submit({url:$.path+"/api/apiResourceMonitor/startStopService",type:"post",params:i,callback:function(i){if(i.code==0){i.message="暂停成功"}else{i.message="暂停失败"}if(e=="0"){t.search(r)}else{t.search(a)}}})}})};var f=function(){$(".ui-grid-linkGroup li").on("click",function(){$(".ui-grid-linkGroup .active").removeClass("active");$(this).addClass("active");var e=$(this).attr("key");switch(e){case"0":$("#subscibeRes").find("input").attr("checked",false);$(".delete").addClass("disabled");$("#publishRes-form").show();$("#subscibeRes-form").hide();r.grid.ajax.reload();$(".publishRes").show();$(".subscibeResWrapper").hide();break;case"1":$("#publishRes").find("input").attr("checked",false);$(".delete").addClass("disabled");$("#publishRes-form").hide();$("#subscibeRes-form").show();a.grid.ajax.reload();$(".publishRes").hide();$(".subscibeResWrapper").show();break}})};var p=function(){$(".ui-grid-buttonbar .delete").on("click",function(){if(!$(this).hasClass("disabled")){var e=$(this).attr("keyAtrr");switch(e){case"0":o();break;case"1":d();break}}});$("table").on("change","input",function(){var t=[],i="",r=$(".ui-grid-linkGroup li.active").attr("key");if(r=="0"){i="publishRes"}else{i="subscibeRes"}if($("#"+i+" tbody input:checked").length>0){$("#"+i+" tbody input:checked").map(function(e,i){var r=$(this).parents("tr").find(".state").attr("title");if(e=="0"){t.push(r)}else{if(t.indexOf(r)<0){t.push(r)}}});if(t.length>1){$(".start").addClass("disabled");$(".stop").addClass("disabled");return e.requestTip().error("不同的状态不能同时勾选")}if(t[0]=="0"){$(".start").addClass("disabled")}else{$(".stop").addClass("disabled")}}})};var b=function(){e.scroll({container:$(".ui-gridbar")})};return{main:function(){u("1");u("2");p();f();l();c();b()}}});